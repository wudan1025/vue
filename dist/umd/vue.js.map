{"version":3,"file":"vue.js","sources":["../../src/observer/array.js","../../src/util.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["// 拿到原型上的方法\nlet oldArrayProtoMethods = Array.prototype\n\n// 继承 原本的原型\nexport let arrayMethods = Object.create(oldArrayProtoMethods)\n\nlet methods = [\n    'push', 'pop', 'shift', 'unshift', 'reverse', 'sort', 'splice'\n]\n\nmethods.forEach(method => {\n    // 重写 原型上的这些方法\n    arrayMethods[method] = function (...args) {\n        // 使用 ...args 将 arguments伪数组 转为 真正的数组\n        const result = oldArrayProtoMethods[method].apply(this, args)\n        let inserted;\n        let ob = this.__ob__\n        switch (method) {\n            case 'push':\n            case 'unshoft':\n                inserted = args\n                break;\n            case 'splice':\n                inserted = args.slice(2); // 第三个参数为新增\n            default:\n                break;\n        }\n        // 对于新增的数据 做双向绑定\n        if (inserted) ob.observeArray(inserted)\n        return result\n    }\n})\n","export function defineProperty(target, key, value) {\n    Object.defineProperty(target, key, {\n        enumerable: false, // 不能被枚举，不能被循环出来 ?\n        configurable: false,\n        value\n    })\n}\n\nexport function proxy(vm, data, key) {\n    Object.defineProperty(vm, key, {\n        get() {\n            return vm[data][key];\n        },\n        set(newvalue) {\n            vm[data][key] = newvalue\n        }\n    })\n}","import { arrayMethods } from './array'\nimport { defineProperty } from \"../util\";\nclass Observer {\n    constructor(value) {\n        // 通过使用__ob__判断元素是否 被监听过\n        defineProperty(value, '__ob__', this);\n        // 数组监听\n        if (Array.isArray(value)) {\n            // 重新定义原型上的方法\n            value.__proto__ = arrayMethods;\n            this.observeArray(value)\n        } else {\n            // 对象监听\n            this.walk(value)\n        }\n    }\n\n    observeArray(value) {\n        value.forEach(item => {\n            observe(item) // 监听数组中内容\n        })\n    }\n\n\n\n    walk(data) {\n        let keys = Object.keys(data)\n        keys.forEach(key => {\n            defineReactive(data, key, data[key])\n        })\n    }\n\n\n}\n\nfunction defineReactive(data, key, value) {\n    observe(value) // 如果当前对象内还有对象，会递归调用 整个过程\n    Object.defineProperty(data, key, {\n        get() {\n            // console.log('get')\n            return value\n        },\n        set(newValue) {\n            if (newValue == value) return\n            observe(newValue) // 如果 set 的数据中还有 obj 继续进行监听\n            value = newValue\n            // console.log('set')\n        }\n    })\n}\n\nexport function observe(data) {\n    // 只对 object 类型数据监听，简单类型不进行监听\n    if (typeof data != 'object' || data == null) {\n        return data\n    }\n\n    // __ob__ 表示当前数据是否已被监听过\n    if (data.__ob__) {\n        return data\n    }\n\n    return new Observer(data)\n}","import { observe } from './observer/index'\nimport { proxy } from './util.js'\n\nexport function initState(vm) { // vm.$options\n    const opts = vm.$options;\n    if (opts.props) {\n        initProps(vm);\n    }\n    if (opts.methods) {\n        initMethods(vm);\n    }\n    if (opts.data) {\n        initData(vm);\n    }\n    if (opts.computed) {\n        initComputed(vm);\n    }\n    if (opts.watch) {\n        initWatch(vm);\n    }\n}\n\nfunction initProps() { }\nfunction initMethods() { }\n\nfunction initData(vm) { // 数据的初始化操作\n    let data = vm.$options.data;\n    vm._data = data = typeof data == 'function' ? data.call(vm) : data;\n    // // 数据的劫持方案 对象Object.defineProperty\n    // // 数组 单独处理的\n\n    // // 当我去vm上取属性时 ，帮我将属性的取值代理到vm._data上\n    for (let key in data) {\n        proxy(vm, '_data', key);\n    }\n    observe(data);\n}\nfunction initComputed() { }\nfunction initWatch() { }","import { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n    Vue.prototype._init = function (options) {\n        // this 指向 new 出来的实例\n        const vm = this;\n        vm.$options = options;\n        initState(vm);\n\n        if (vm.$options.el) {\n            vm.$mount(vm.$options.el)\n        }\n    }\n\n    Vue.prototype.$mount = function (el) {\n        const vm = this;\n        const options = vm.$options;\n        el = document.querySelector(el)\n        vm.$el = el\n\n        if (!options.render) {\n            // 没有render 将 template 转化为render\n            let template = options.template\n            if (!template && el) {\n                template = el.outerHTML\n            }\n        }\n    }\n}","import { initMixin } from './init'\n\n\nfunction Vue(options) {\n    this._init(options)\n}\n\n// 写成插件对原型进行扩展\ninitMixin(Vue)\n\nexport default Vue"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","result","apply","inserted","ob","__ob__","slice","observeArray","defineProperty","target","key","value","enumerable","configurable","proxy","vm","data","get","set","newvalue","Observer","isArray","__proto__","walk","item","observe","keys","defineReactive","newValue","initState","opts","$options","props","initData","computed","watch","_data","call","initMixin","Vue","_init","options","el","$mount","document","querySelector","$el","render","template","outerHTML"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;EACA,IAAIA,oBAAoB,GAAGC,KAAK,CAACC,SAAjC;;EAGO,IAAIC,YAAY,GAAGC,MAAM,CAACC,MAAP,CAAcL,oBAAd,CAAnB;EAEP,IAAIM,OAAO,GAAG,CACV,MADU,EACF,KADE,EACK,OADL,EACc,SADd,EACyB,SADzB,EACoC,MADpC,EAC4C,QAD5C,CAAd;EAIAA,OAAO,CAACC,OAAR,CAAgB,UAAAC,MAAM,EAAI;EACtB;EACAL,EAAAA,YAAY,CAACK,MAAD,CAAZ,GAAuB,YAAmB;EAAA,sCAANC,IAAM;EAANA,MAAAA,IAAM;EAAA;;EACtC;EACA,QAAMC,MAAM,GAAGV,oBAAoB,CAACQ,MAAD,CAApB,CAA6BG,KAA7B,CAAmC,IAAnC,EAAyCF,IAAzC,CAAf;EACA,QAAIG,QAAJ;EACA,QAAIC,EAAE,GAAG,KAAKC,MAAd;;EACA,YAAQN,MAAR;EACI,WAAK,MAAL;EACA,WAAK,SAAL;EACII,QAAAA,QAAQ,GAAGH,IAAX;EACA;;EACJ,WAAK,QAAL;EACIG,QAAAA,QAAQ,GAAGH,IAAI,CAACM,KAAL,CAAW,CAAX,CAAX;EANR,KALsC;;;EAgBtC,QAAIH,QAAJ,EAAcC,EAAE,CAACG,YAAH,CAAgBJ,QAAhB;EACd,WAAOF,MAAP;EACH,GAlBD;EAmBH,CArBD;;ECVO,SAASO,cAAT,CAAwBC,MAAxB,EAAgCC,GAAhC,EAAqCC,KAArC,EAA4C;EAC/ChB,EAAAA,MAAM,CAACa,cAAP,CAAsBC,MAAtB,EAA8BC,GAA9B,EAAmC;EAC/BE,IAAAA,UAAU,EAAE,KADmB;EACZ;EACnBC,IAAAA,YAAY,EAAE,KAFiB;EAG/BF,IAAAA,KAAK,EAALA;EAH+B,GAAnC;EAKH;EAEM,SAASG,KAAT,CAAeC,EAAf,EAAmBC,IAAnB,EAAyBN,GAAzB,EAA8B;EACjCf,EAAAA,MAAM,CAACa,cAAP,CAAsBO,EAAtB,EAA0BL,GAA1B,EAA+B;EAC3BO,IAAAA,GAD2B,iBACrB;EACF,aAAOF,EAAE,CAACC,IAAD,CAAF,CAASN,GAAT,CAAP;EACH,KAH0B;EAI3BQ,IAAAA,GAJ2B,eAIvBC,QAJuB,EAIb;EACVJ,MAAAA,EAAE,CAACC,IAAD,CAAF,CAASN,GAAT,IAAgBS,QAAhB;EACH;EAN0B,GAA/B;EAQH;;MCfKC;EACF,oBAAYT,KAAZ,EAAmB;EAAA;;EACf;EACAH,IAAAA,cAAc,CAACG,KAAD,EAAQ,QAAR,EAAkB,IAAlB,CAAd,CAFe;;EAIf,QAAInB,KAAK,CAAC6B,OAAN,CAAcV,KAAd,CAAJ,EAA0B;EACtB;EACAA,MAAAA,KAAK,CAACW,SAAN,GAAkB5B,YAAlB;EACA,WAAKa,YAAL,CAAkBI,KAAlB;EACH,KAJD,MAIO;EACH;EACA,WAAKY,IAAL,CAAUZ,KAAV;EACH;EACJ;;;;mCAEYA,OAAO;EAChBA,MAAAA,KAAK,CAACb,OAAN,CAAc,UAAA0B,IAAI,EAAI;EAClBC,QAAAA,OAAO,CAACD,IAAD,CAAP,CADkB;EAErB,OAFD;EAGH;;;2BAIIR,MAAM;EACP,UAAIU,IAAI,GAAG/B,MAAM,CAAC+B,IAAP,CAAYV,IAAZ,CAAX;EACAU,MAAAA,IAAI,CAAC5B,OAAL,CAAa,UAAAY,GAAG,EAAI;EAChBiB,QAAAA,cAAc,CAACX,IAAD,EAAON,GAAP,EAAYM,IAAI,CAACN,GAAD,CAAhB,CAAd;EACH,OAFD;EAGH;;;;;;EAKL,SAASiB,cAAT,CAAwBX,IAAxB,EAA8BN,GAA9B,EAAmCC,KAAnC,EAA0C;EACtCc,EAAAA,OAAO,CAACd,KAAD,CAAP,CADsC;;EAEtChB,EAAAA,MAAM,CAACa,cAAP,CAAsBQ,IAAtB,EAA4BN,GAA5B,EAAiC;EAC7BO,IAAAA,GAD6B,iBACvB;EACF;EACA,aAAON,KAAP;EACH,KAJ4B;EAK7BO,IAAAA,GAL6B,eAKzBU,QALyB,EAKf;EACV,UAAIA,QAAQ,IAAIjB,KAAhB,EAAuB;EACvBc,MAAAA,OAAO,CAACG,QAAD,CAAP,CAFU;;EAGVjB,MAAAA,KAAK,GAAGiB,QAAR,CAHU;EAKb;EAV4B,GAAjC;EAYH;;EAEM,SAASH,OAAT,CAAiBT,IAAjB,EAAuB;EAC1B;EACA,MAAI,QAAOA,IAAP,KAAe,QAAf,IAA2BA,IAAI,IAAI,IAAvC,EAA6C;EACzC,WAAOA,IAAP;EACH,GAJyB;;;EAO1B,MAAIA,IAAI,CAACX,MAAT,EAAiB;EACb,WAAOW,IAAP;EACH;;EAED,SAAO,IAAII,QAAJ,CAAaJ,IAAb,CAAP;EACH;;EC5DM,SAASa,SAAT,CAAmBd,EAAnB,EAAuB;EAAE;EAC5B,MAAMe,IAAI,GAAGf,EAAE,CAACgB,QAAhB;;EACA,MAAID,IAAI,CAACE,KAAT,EAAgB;;EAGhB,MAAIF,IAAI,CAACjC,OAAT,EAAkB;;EAGlB,MAAIiC,IAAI,CAACd,IAAT,EAAe;EACXiB,IAAAA,QAAQ,CAAClB,EAAD,CAAR;EACH;;EACD,MAAIe,IAAI,CAACI,QAAT,EAAmB;;EAGnB,MAAIJ,IAAI,CAACK,KAAT,EAAgB;EAGnB;;EAKD,SAASF,QAAT,CAAkBlB,EAAlB,EAAsB;EAAE;EACpB,MAAIC,IAAI,GAAGD,EAAE,CAACgB,QAAH,CAAYf,IAAvB;EACAD,EAAAA,EAAE,CAACqB,KAAH,GAAWpB,IAAI,GAAG,OAAOA,IAAP,IAAe,UAAf,GAA4BA,IAAI,CAACqB,IAAL,CAAUtB,EAAV,CAA5B,GAA4CC,IAA9D,CAFkB;EAIlB;EAEA;;EACA,OAAK,IAAIN,GAAT,IAAgBM,IAAhB,EAAsB;EAClBF,IAAAA,KAAK,CAACC,EAAD,EAAK,OAAL,EAAcL,GAAd,CAAL;EACH;;EACDe,EAAAA,OAAO,CAACT,IAAD,CAAP;EACH;;EClCM,SAASsB,SAAT,CAAmBC,GAAnB,EAAwB;EAC3BA,EAAAA,GAAG,CAAC9C,SAAJ,CAAc+C,KAAd,GAAsB,UAAUC,OAAV,EAAmB;EACrC;EACA,QAAM1B,EAAE,GAAG,IAAX;EACAA,IAAAA,EAAE,CAACgB,QAAH,GAAcU,OAAd;EACAZ,IAAAA,SAAS,CAACd,EAAD,CAAT;;EAEA,QAAIA,EAAE,CAACgB,QAAH,CAAYW,EAAhB,EAAoB;EAChB3B,MAAAA,EAAE,CAAC4B,MAAH,CAAU5B,EAAE,CAACgB,QAAH,CAAYW,EAAtB;EACH;EACJ,GATD;;EAWAH,EAAAA,GAAG,CAAC9C,SAAJ,CAAckD,MAAd,GAAuB,UAAUD,EAAV,EAAc;EACjC,QAAM3B,EAAE,GAAG,IAAX;EACA,QAAM0B,OAAO,GAAG1B,EAAE,CAACgB,QAAnB;EACAW,IAAAA,EAAE,GAAGE,QAAQ,CAACC,aAAT,CAAuBH,EAAvB,CAAL;EACA3B,IAAAA,EAAE,CAAC+B,GAAH,GAASJ,EAAT;;EAEA,QAAI,CAACD,OAAO,CAACM,MAAb,EAAqB;EACjB;EACA,UAAIC,QAAQ,GAAGP,OAAO,CAACO,QAAvB;;EACA,UAAI,CAACA,QAAD,IAAaN,EAAjB,EAAqB;EACjBM,QAAAA,QAAQ,GAAGN,EAAE,CAACO,SAAd;EACH;EACJ;EACJ,GAbD;EAcH;;ECzBD,SAASV,GAAT,CAAaE,OAAb,EAAsB;EAClB,OAAKD,KAAL,CAAWC,OAAX;EACH;;;EAGDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}